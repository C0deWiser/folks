(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{184:function(e,t,n){"use strict";n.r(t);var o={data:function(){return{roles:[],search:"",searchWidth:120,searchingColumn:null,table:[],page:0,noMore:!1,loading:!1,edit:null,create:!1,form:{}}},computed:{disabled:function(){return this.loading||this.noMore},tableData:function(){var e=this,t=this.table.filter((function(e){return null===e.deleted_at}));return this.searchingColumn&&this.search?t.filter((function(t){return~t[e.searchingColumn.property].indexOf(e.search)})):t},editableUser:function(){var e=this;return this.table.find((function(t){return t.id===e.edit}))}},methods:{searchColumnIcon:function(e){return this.searchingColumn===e?"el-icon-close":"el-icon-search"},searchByColumn:function(e){this.searchingColumn===e?(this.searchingColumn=null,this.search=""):this.searchingColumn=e},filterByRole:function(e,t,n){return t[n.property].find((function(t){return t.id===e}))},getRelatioins:function(){},getRoles:function(){var e=this;this.$http.get("/rpac/roles").then((function(t){e.roles=t.data})).catch((function(e){return console.error(e)}))},storeUser:function(){var e=this;this.$http.post("/rpac/users",Object.assign({_method:"POST"},this.form)).then((function(t){e.create=!1,e.form={},e.table.push(t.data)})).catch((function(e){return console.error(e)}))},updateUser:function(){var e=this;this.$http.post("/rpac/users/"+this.edit,Object.assign({_method:"PUT"},this.editableUser)).then((function(t){console.log(t.data),e.edit=null})).catch((function(e){return console.error(e)}))},deleteUser:function(e){var t=this;this.$http.post("/rpac/users/"+e,Object.assign({_method:"DELETE"},{})).then((function(n){console.log(n.data),t.table.find((function(t){return t.id===e})).deleted_at=n.data})).catch((function(e){return console.error(e)}))},loadRows:function(){var e=this;this.loading=!0,this.$http.get("/rpac/users?page="+ ++this.page).then((function(e){return e.data})).then((function(t){t.total&&t.to?(t.current_page===t.last_page&&(e.noMore=!0),t.current_page===e.page&&(e.table=e.table.concat(t.data),console.warn("loadRows",t,e.page))):(e.table=t,console.error("loadRows where paginate?",t,e.page)),e.loading=!1})).catch((function(e){return console.error(e)}))},getRows:function(){var e=this;this.$http.get("/rpac/users").then((function(t){var n=t.data;e.table=n,e.loading=!1})).catch((function(e){return console.error(e)}))}},mounted:function(){this.getRoles()}},l=(n(88),n(1)),a=Object(l.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-main",[n("el-row",[n("el-col",{attrs:{span:12}},[n("h3",{staticStyle:{margin:"0"}},[n("i",{staticClass:"el-icon-user"}),e._v(" Пользователи")])]),e._v(" "),n("el-col",{staticStyle:{"text-align":"right"},attrs:{span:12}},[n("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:function(t){e.create=!0}}},[e._v("Создать")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"Новый пользователь",visible:e.create},on:{"update:visible":function(t){e.create=t}}},[n("el-form",{attrs:{model:e.form,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"Имя"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"Email"}},[n("el-input",{attrs:{type:"email",autocomplete:"off"},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"Роль"}},[n("el-select",{attrs:{multiple:"","value-key":"id",placeholder:"Роль"},model:{value:e.form.roles,callback:function(t){e.$set(e.form,"roles",t)},expression:"form.roles"}},e._l(e.roles,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1)],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.create=!1}}},[e._v("Отмена")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.storeUser}},[e._v("Сохранить")])],1)],1),e._v(" "),n("div",{staticStyle:{"max-height":"70vh",overflow:"hidden auto"}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"},{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadRows,expression:"loadRows"}],staticStyle:{"min-width":"100%"},attrs:{data:e.tableData,"infinite-scroll-disabled":"disabled"}},[n("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID",width:"40"}}),e._v(" "),n("el-table-column",{attrs:{prop:"name",label:"Имя",sortable:"",width:"200"},scopedSlots:e._u([{key:"header",fn:function(t){return[e.searchingColumn===t.column?n("span",{staticClass:"search-column-wrap",on:{click:function(e){e.stopPropagation(),e.preventDefault()}}},[n("el-input",{attrs:{size:"mini",placeholder:t.column.label},on:{focus:function(e){e.stopPropagation(),e.preventDefault()}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1):n("span",[e._v(e._s(t.column.label))]),e._v(" "),n("el-button",{attrs:{type:"text",icon:e.searchingColumn===t.column?"el-icon-close":"el-icon-search"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),e.searchByColumn(t.column)}}})]}},{key:"default",fn:function(t){return[e.edit===t.row.id?n("el-input",{attrs:{placeholder:t.column.label},model:{value:t.row.name,callback:function(n){e.$set(t.row,"name",n)},expression:"scope.row.name"}}):n("strong",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"email",label:"Email",sortable:"",width:"200"},scopedSlots:e._u([{key:"header",fn:function(t){return[e.searchingColumn===t.column?n("span",{staticClass:"search-column-wrap",on:{click:function(e){e.stopPropagation(),e.preventDefault()}}},[n("el-input",{attrs:{size:"mini",placeholder:t.column.label},on:{focus:function(e){e.stopPropagation(),e.preventDefault()}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1):n("span",[e._v(e._s(t.column.label))]),e._v(" "),n("el-button",{attrs:{type:"text",icon:e.searchingColumn===t.column?"el-icon-close":"el-icon-search"},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),e.searchByColumn(t.column)}}})]}},{key:"default",fn:function(t){return[e.edit===t.row.id?n("el-input",{attrs:{placeholder:t.column.label},model:{value:t.row.email,callback:function(n){e.$set(t.row,"email",n)},expression:"scope.row.email"}}):n("strong",[e._v(e._s(t.row.email))])]}}])}),e._v(" "),n("el-table-column",{attrs:{prop:"roles",label:"Роли",sortable:"",filters:e.roles.length?e.roles.map((function(e){return{text:e.name,value:e.id}})):[],"filter-method":e.filterByRole,width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.edit===t.row.id?n("el-select",{staticStyle:{"margin-left":"20px"},attrs:{multiple:"","off--collapse-tags":"","value-key":"id",placeholder:t.column.label},model:{value:t.row.roles,callback:function(n){e.$set(t.row,"roles",n)},expression:"scope.row.roles"}},e._l(e.roles,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e}})})),1):n("span",[t.row.roles&&t.row.roles.length?e._l(t.row.roles,(function(t,o){return n("el-tag",{key:o,attrs:{size:"mini"}},[e._v(e._s(t.name))])})):e._e()],2)]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"JSON",width:"800"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("small",{class:{"no-wrap":e.edit!==t.row.id}},[e._v(e._s(JSON.stringify(t.row)))])]}}])}),e._v(" "),n("el-table-column",{attrs:{fixed:"right",width:e.searchWidth,align:"right"},scopedSlots:e._u([{key:"header",fn:function(t){return[e._v("\n                    #\n                ")]}},{key:"default",fn:function(t){return[e.edit===t.row.id?n("el-button-group",[n("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-check",plain:""},on:{click:e.updateUser}}),e._v(" "),n("el-button",{attrs:{type:"danger",size:"small",icon:"el-icon-close",plain:""},on:{click:function(t){e.edit=!1}}})],1):n("el-button-group",[n("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-edit",title:t.row.id},on:{click:function(n){e.edit=t.row.id}}}),e._v(" "),n("el-popconfirm",e._g({attrs:{confirmButtonText:"Удалить",confirmButtonType:"danger",cancelButtonText:"Отмена",icon:"el-icon-delete",iconColor:"red",title:"Удалить этого пользователя?"},on:{confirm:function(n){return e.deleteUser(t.row.id)}}},{onConfirm:function(n){return e.deleteUser(t.row.id)},onCancel:function(e){return!1}}),[n("el-button",{attrs:{slot:"reference",type:"danger",size:"small",icon:"el-icon-delete"},slot:"reference"})],1)],1)]}}])})],1)],1)],1)}),[],!1,null,"50ecc494",null);t.default=a.exports},20:function(e,t,n){var o=n(89);"string"==typeof o&&(o=[[e.i,o,""]]);var l={hmr:!0,transform:void 0,insertInto:void 0};n(16)(o,l);o.locals&&(e.exports=o.locals)},88:function(e,t,n){"use strict";var o=n(20);n.n(o).a},89:function(e,t,n){(e.exports=n(15)(!1)).push([e.i,".el-form-item__label[data-v-50ecc494] {\n  width: 120px;\n}\n.el-dialog__title[data-v-50ecc494] {\n  padding-left: 120px;\n}\n.el-dialog__footer[data-v-50ecc494] {\n  text-align: left;\n  padding-left: 140px;\n}\n.el-input__suffix[data-v-50ecc494] {\n  right: 10px;\n}\n.el-table th[data-v-50ecc494],\n.el-table td[data-v-50ecc494] {\n  vertical-align: text-top;\n}\n.tar[data-v-50ecc494] {\n  text-align: right;\n}\n.no-wrap[data-v-50ecc494] {\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  max-width: 100%;\n  overflow: hidden;\n  display: inline-block;\n}\n.search-column-wrap[data-v-50ecc494] {\n  width: 80px;\n  display: inline-block;\n}",""])}}]);